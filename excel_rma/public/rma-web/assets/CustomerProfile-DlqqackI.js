var B=Object.defineProperty;var P=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var v=(e,t,r)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,L=(e,t)=>{for(var r in t||(t={}))F.call(t,r)&&v(e,r,t[r]);if(P)for(var r of P(t))A.call(t,r)&&v(e,r,t[r]);return e};import{r as m,C as I,a8 as $,aU as V,aV as E,aW as M,aX as T,d as W,aY as R,aZ as z,a_ as U,a$ as j,b0 as Y,b1 as q,b2 as G,b3 as H,b4 as S,b5 as Q,b6 as X,b7 as Z,u as J,b8 as K,j as s,b9 as O,aQ as D,aR as ee,aS as te,aT as se,ba as ae}from"./index-DQE3-2uI.js";import{w as re,p as ne,q as ie,A as le}from"./commonApi-CqE4iSRE.js";import{C as oe}from"./CustomTable-BC6PPhBt.js";import{B as N}from"./index-DTzYNCIA.js";import{f}from"./helper-CAkyw8rs.js";import{A as ce}from"./AntInput-oWAdE42b.js";import"./index-Bf1NQ104.js";import"./bundle-mjs-Bbh6cNEC.js";import"./index-Do0Jgect.js";import"./clsx-B-dksMZM.js";import"./index-CSUC_KtR.js";var de=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(r[a[n]]=e[a[n]]);return r};const me=e=>{const{prefixCls:t,className:r,closeIcon:a,closable:n,type:i,title:c,children:x,footer:g}=e,C=de(e,["prefixCls","className","closeIcon","closable","type","title","children","footer"]),{getPrefixCls:p}=m.useContext(I),h=p(),d=t||p("modal"),u=$(h),[b,_,w]=V(d,u),y=`${d}-confirm`;let l={};return i?l={closable:n!=null?n:!1,title:"",footer:"",children:m.createElement(E,Object.assign({},e,{prefixCls:d,confirmPrefixCls:y,rootPrefixCls:h,content:x}))}:l={closable:n!=null?n:!0,title:c,footer:g!==null&&m.createElement(M,Object.assign({},e)),children:x},b(m.createElement(T,Object.assign({prefixCls:d,className:W(_,`${d}-pure-panel`,i&&y,i&&`${y}-${i}`,r,w,u)},C,{closeIcon:R(d,a),closable:n},l)))},ue=re(me);function k(e){return j(X(e))}const o=z;o.useModal=U;o.info=function(t){return j(Y(t))};o.success=function(t){return j(q(t))};o.error=function(t){return j(G(t))};o.warning=k;o.warn=k;o.confirm=function(t){return j(H(t))};o.destroyAll=function(){for(;S.length;){const t=S.pop();t&&t()}};o.config=Q;o._InternalPanelDoNotUseOrYouWillBeFired=ue;const fe=e=>{const t=Z(),{isOpen:r}=J(K),a=()=>{t(O({type:"",isOpen:!1}))};return s.jsx(o,L({footer:!1,open:r,centered:!0,onCancel:a},e))},xe=({customer_name:e,territory:t})=>{const[r]=D(),{limit_start:a,pageSize:n}=ne(r),i=[...e?[["name","like",`%${e}%`]]:[],...t?[["territory","like",`%${t}%`]]:[]],{data:c,isLoading:x,isValidating:g,error:C}=ee("Customer",{fields:["name","customer_name","territory","excel_remaining_balance","custom_other_brands_limit"],filters:i,orderBy:{field:"name",order:"asc"},limit:n,limit_start:a}),{data:p,isLoading:h,isValidating:d,error:u}=te("Customer",i);return{data:c,isLoading:x||h,isValidating:g||d,error:C||u,total:p}},pe=e=>se("Customer",e,`name:${e}`,{isPaused:()=>!e}),he=e=>{const t=ae();return m.useMemo(()=>[{key:"Sl",title:"SL",render:(a,n,i)=>s.jsx("span",{children:i+1})},{key:"customer_name",title:"Customer Name"},{key:"territory",title:"Territory Name"},{key:"excel_remaining_balance",title:"Credit Limit",render:a=>f(a)},{key:"current_outstanding",title:"Current Outstanding",render:a=>f(a)},{key:"custom_other_brands_limit",title:"Remaining Credit",render:a=>f(a)},{key:"brand_wise_limit",title:"Brand Wise Limit",render:(a,n)=>s.jsx(N,{variant:"outline-primary",size:"sm",onClick:()=>{e(n.customer_name),t(O({type:"brand-wise-limit",isOpen:!0}))},children:"Details"})}],[e,t])},ge=({customerDocument:e})=>{var t,r;return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"bg-white dark:bg-darkmode rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-center my-4",children:[s.jsxs("div",{className:"text-lg font-semibold",children:["Total Remaining Balance:"," ",s.jsx("span",{className:"text-lg font-bold",children:f((e==null?void 0:e.excel_remaining_balance)||0)})]}),s.jsxs("div",{className:"text-lg font-semibold",children:["Brand Wise Allocated Limit:"," ",s.jsx("span",{className:"text-lg font-bold",children:f(((t=e==null?void 0:e.custom_brand_wise_allocations)==null?void 0:t.reduce((a,n)=>a+n.limit,0))||0)})]})]}),s.jsx("div",{className:"overflow-x-auto rounded-lg border",children:s.jsxs("table",{className:"min-w-full table-auto",children:[s.jsx("thead",{className:"bg-primary text-white",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left",children:"Brand Name"}),s.jsx("th",{className:"px-6 py-3 text-left",children:"Limit Amount"})]})}),s.jsxs("tbody",{className:"bg-gray-50",children:[(r=e==null?void 0:e.custom_brand_wise_allocations)==null?void 0:r.map(a=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 text-left",children:a.brand}),s.jsx("td",{className:"px-6 py-4 text-left",children:f(a.limit)})]},a.name)),s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 text-left",children:"Others"}),s.jsx("td",{className:"px-6 py-4 text-left",children:f((e==null?void 0:e.custom_other_brands_limit)||0)})]})]})]})})]})})},ke=()=>{const[e,t]=m.useState(""),[r,a]=m.useState(null),[n,i]=m.useState(null),[c,x]=m.useState(null),{data:g,isLoading:C,total:p}=xe({customer_name:r!=null?r:"",territory:c!=null?c:""}),{data:h,isLoading:d,mutate:u}=pe(e),{data:b,isLoading:_}=ie(n);m.useEffect(()=>{e&&u()},[e,u]);const w=he(t),y=()=>{a(null),i(null)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-wrap items-center col-span-12 mt-5 intro-y xl:flex-nowrap gap-3",children:[s.jsx("h2",{className:"text-lg font-medium intro-y whitespace-nowrap",children:"Customer Profile"}),s.jsxs("div",{className:"flex w-full gap-2 flex-wrap lg:flex-nowrap",children:[s.jsx(ce,{placeholder:"Customer Name",type:"text",onChange:l=>a(l.target.value),value:r!=null?r:""}),s.jsx(le,{placeholder:"Select Branch",value:c!=null?c:void 0,onChange:l=>{x(l),i(null)},onSearch:l=>i(l),loading:_,options:b==null?void 0:b.map(l=>({value:l.name,label:l.territory_name})),notFoundText:"No Branch Found"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{variant:"outline-primary",children:"Search"}),s.jsx(N,{onClick:y,variant:"outline-primary",children:"Clear"})]})]})]}),s.jsx("div",{className:"mt-5",children:s.jsx(oe,{tableHeader:w||[],data:g||[],loading:C,totalItems:p||0})}),s.jsx(fe,{title:s.jsxs("div",{className:"text-xl font-semibold text-center border-b border-gray-200 pb-2",children:["Brand Wise Limit - ",e]}),loading:d,width:800,children:s.jsx(ge,{customerDocument:h})})]})};export{ke as default};
