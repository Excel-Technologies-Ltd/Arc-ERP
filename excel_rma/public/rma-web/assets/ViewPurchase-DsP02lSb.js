var F=Object.defineProperty;var w=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var A=(s,a,r)=>a in s?F(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,L=(s,a)=>{for(var r in a||(a={}))O.call(a,r)&&A(s,r,a[r]);if(w)for(var r of w(a))C.call(a,r)&&A(s,r,a[r]);return s};var R=(s,a,r)=>new Promise((t,c)=>{var h=o=>{try{m(r.next(o))}catch(n){c(n)}},u=o=>{try{m(r.throw(o))}catch(n){c(n)}},m=o=>o.done?t(o.value):Promise.resolve(o.value).then(h,u);m((r=r.apply(s,a)).next())});import{j as e,c as D,a as E,r as b,u as q,d as Y,M as H,L as B,e as J}from"./index-BpSF5Wtu.js";import{a as U,p as W}from"./purchase-BMc_n8j5.js";import{u as z}from"./index.esm-BHkfE-lQ.js";import{d as y,a as G}from"./helper-crQtQ34Z.js";import{a as K}from"./index-D9i1hHMe.js";import"./app-strings-D56g2F-8.js";import{L as f,S as Q,P as X}from"./SerialAssignForm-_ofKwZFg.js";import{T as Z}from"./index-DQfblts6.js";import"./AntDatePicker-DgPHlk_s.js";import"./index-D1ByBYj1.js";import{u as I}from"./useNotify-DNLL4Hh3.js";import"./pagination.utils-Dq4giu9F.js";import"./roundedArrow-Y7rqzAmY.js";import"./useMergedState-Bb5lufc3.js";import"./index-CYeHRA9O.js";import"./bundle-mjs-Bbh6cNEC.js";import"./index-K-zqVkRk.js";import"./index-CY4oh9uF.js";import"./AntSelect-BnnGOX_h.js";import"./LeftOutlined-BPzNSWSG.js";import"./AntInput-C6QLD0ga.js";import"./iconBase-C_eXM84s.js";import"./AntCustomTable-DFoJuGHn.js";import"./dropdown-BXU6j2sW.js";import"./RenderController-BlO8I0ao.js";import"./AntUpload-CMwM9kKH.js";import"./dropdownApi-Cjg73vvp.js";import"./doctype-strings-B61UNAtB.js";const ee=({title:s="Details",items:a,className:r="",titleClassName:t="",itemClassName:c="",iconClassName:h="",valueClassName:u="",border:m=!0})=>e.jsxs("div",{className:`p-5 rounded-md bg-white shadow-sm border border-gray-200 dark:bg-darkmode-800 dark:border-darkmode-600 ${r}`,children:[s&&e.jsx("div",{className:`flex items-center pb-5 mb-5 ${m?"border-b border-slate-200/60 dark:border-darkmode-400":""}`,children:e.jsx("div",{className:`text-base font-medium truncate ${t}`,children:s})}),a.map((o,n)=>e.jsxs("div",{className:`flex items-center ${n>0?"mt-3":""} ${c}`,children:[o.icon&&e.jsx("span",{className:`w-4 h-4 mr-2 flex items-center justify-center ${h}`,children:o.icon}),e.jsxs("span",{className:"mr-1 text-slate-700 dark:text-slate-300",children:[o.label,":"]}),o.isLink?e.jsx("span",{className:`ml-1 underline decoration-dotted text-blue-600 dark:text-blue-400 ${u}`,children:o.value}):e.jsx("span",{className:`ml-1 text-slate-900 dark:text-slate-100 ${u}`,children:o.value})]},n))]}),se=({data:s})=>{var r;const a=[{icon:e.jsx(f,{className:"text-slate-500"}),label:"Invoice",value:s.name||"N/A",isLink:!0},{icon:e.jsx(f,{className:"text-slate-500"}),label:"Order",value:((r=s.items[0])==null?void 0:r.purchase_order)||"N/A",isLink:!0},{icon:e.jsx(f,{className:"text-slate-500"}),label:"Supplier",value:s.supplier_name||"N/A"},{icon:e.jsx(f,{className:"text-slate-500"}),label:"Posting Date",value:s.posting_date||"N/A"},{icon:e.jsx(f,{className:"text-slate-500"}),label:"Warehouse",value:s.set_warehouse||"N/A"},{icon:e.jsx(f,{className:"text-slate-500"}),label:"Status",value:e.jsx(Z,{color:"blue",children:s.status||"Unknown"})}];return e.jsx(e.Fragment,{children:e.jsx(ee,{title:"Purchase Details",items:a})})},ae=s=>{var a;return{warehouse:(a=s==null?void 0:s.set_warehouse)!=null?a:void 0,date:s!=null&&s.posting_date?y(s.posting_date):y(),file:void 0,fromRange:"",toRange:"",totalRangeValue:""}},Pe=()=>{const{invoice_number:s}=D(),a=I(),r=E(),{data:t,isLoading:c,isValidating:h}=U(s!=null?s:""),{call:u,loading:m}=W(),o=b.useMemo(()=>ae(t==null?void 0:t.message),[t]),{control:n,watch:T,handleSubmit:M,setValue:k,reset:P}=z({values:o,mode:"onChange",resetOptions:{keepDirtyValues:!0}}),[x,p]=T(["fromRange","toRange"]),{total:v,error:S}=b.useMemo(()=>G(x,p),[x,p]),N=q(Y);b.useEffect(()=>{S&&x&&p&&a.error({message:S})},[S,x,p,a]),b.useEffect(()=>{x&&p&&k("totalRangeValue",v.toString(),{shouldValidate:!0,shouldDirty:!0})},[x,p,k,v]),H("serial_assign_process",i=>{a.info({message:"Processing...",key:"processing",description:e.jsx("li",{children:i.message}),duration:0})});const V=()=>{P(),r(J())},_=b.useMemo(()=>N.reduce((i,d)=>{const l=d.item_name;return i[l]?(i[l].qty+=d.qty,i[l].amount+=d.amount,i[l].serial_no=[...i[l].serial_no,...d.serial_no]):i[l]=L({},d),i},{}),[N]),$=i=>R(void 0,null,function*(){if(Object.values(_).length===0){a.error({message:"No items to assign"});return}const d={posting_date:y(i.date).format("YYYY-MM-DD"),posting_time:y(i.date).format("HH:mm:ss"),purchase_invoice_name:t==null?void 0:t.message.name,supplier:t==null?void 0:t.message.supplier,total:N.reduce((l,g)=>{var j;return l+((j=g.amount)!=null?j:0)},0),total_qty:N.reduce((l,g)=>{var j;return l+((j=g.qty)!=null?j:0)},0),warehouse:i.warehouse,items:Object.values(_)};yield u(d).then(l=>{var g;a.success({message:(g=JSON.parse(l.message))==null?void 0:g.message}),V()}).catch(l=>{a.error({message:"ERROR",description:l.exception})}).finally(()=>{a.close("processing")})});return c||h?e.jsx(B,{pageLoader:!0}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center mt-8 intro-y sm:flex-row",children:[e.jsx("h2",{className:"mr-auto text-lg font-medium",children:"Transaction Details"}),e.jsx("div",{className:"flex w-full mt-4 sm:w-auto sm:mt-0",children:e.jsx(K,{color:"primary",variant:"solid",onClick:M($),loading:m,children:"Submit"})})]}),e.jsxs("div",{className:"grid grid-cols-11 gap-5 mt-5",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-4 2xl:col-span-3 intro-y",children:[t&&e.jsx(se,{data:t==null?void 0:t.message}),e.jsxs("div",{className:"p-5 rounded-md box mt-5",children:[e.jsx("div",{className:"flex items-center pb-5 mb-5 border-b border-slate-200/60 dark:border-darkmode-400",children:e.jsx("div",{className:"text-base font-medium truncate",children:"Serial Assign"})}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsx(Q,{control:n,items:(t==null?void 0:t.message.items)||[]}),e.jsxs("p",{className:"text-lg text-primary",children:["Total : ",v]})]})]})]}),e.jsx("div",{className:"col-span-12 lg:col-span-7 2xl:col-span-8 intro-x",children:e.jsx(X,{data:t==null?void 0:t.message,control:n,setValue:k})})]})]})};export{Pe as default};
