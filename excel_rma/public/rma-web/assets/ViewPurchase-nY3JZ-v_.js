var F=Object.defineProperty;var S=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var _=(s,a,t)=>a in s?F(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,w=(s,a)=>{for(var t in a||(a={}))M.call(a,t)&&_(s,t,a[t]);if(S)for(var t of S(a))C.call(a,t)&&_(s,t,a[t]);return s};var A=(s,a,t)=>new Promise((r,d)=>{var h=o=>{try{c(t.next(o))}catch(m){d(m)}},u=o=>{try{c(t.throw(o))}catch(m){d(m)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(h,u);c((t=t.apply(s,a)).next())});import{j as e,c as E,a as O,r as j,u as q,d as Y,M as H,L as B,e as J}from"./index-DCZ0UN8-.js";import{a as U,p as W}from"./purchase-kvhebXfl.js";import{u as z}from"./index.esm-Do8PqvYq.js";import{d as b,a as G}from"./helper-CwCF0Gnu.js";import{a as I}from"./index-ctMGf2eM.js";import"./app-strings-SWYhzDJs.js";import{L as g,S as K,P as Q}from"./SerialAssignForm-EvWLdInp.js";import{T as X}from"./index-B9BTWh26.js";import"./AntDatePicker-C8QY_plD.js";import"./index-BcxYyanD.js";import{u as Z}from"./useNotify-CdKYUXLF.js";import"./pagination.utils-Dq4giu9F.js";import"./doctype-strings-C-G4L_vj.js";import"./roundedArrow-DgA9nPZM.js";import"./useMergedState-C70scdEg.js";import"./index-BWatvjzD.js";import"./bundle-mjs-Bbh6cNEC.js";import"./index-BRQSaQKC.js";import"./index-DfKWmy64.js";import"./AntSelect-DgCb2yTq.js";import"./LeftOutlined-CmLSScSJ.js";import"./AntInput-WMq0By1Z.js";import"./iconBase-1DXeNUTL.js";import"./AntCustomTable-BMVYCD4q.js";import"./dropdown-ZzFTzWBL.js";import"./RenderController-BDtEhIH_.js";import"./AntUpload-DtXhVQJr.js";import"./dropdownApi-DKvoBZ32.js";const ee=({title:s="Details",items:a,className:t="",titleClassName:r="",itemClassName:d="",iconClassName:h="",valueClassName:u="",border:c=!0})=>e.jsxs("div",{className:`p-5 rounded-md bg-white shadow-sm border border-gray-200 dark:bg-darkmode-800 dark:border-darkmode-600 ${t}`,children:[s&&e.jsx("div",{className:`flex items-center pb-5 mb-5 ${c?"border-b border-slate-200/60 dark:border-darkmode-400":""}`,children:e.jsx("div",{className:`text-base font-medium truncate ${r}`,children:s})}),a.map((o,m)=>e.jsxs("div",{className:`flex items-center ${m>0?"mt-3":""} ${d}`,children:[o.icon&&e.jsx("span",{className:`w-4 h-4 mr-2 flex items-center justify-center ${h}`,children:o.icon}),e.jsxs("span",{className:"mr-1 text-slate-700 dark:text-slate-300",children:[o.label,":"]}),o.isLink?e.jsx("span",{className:`ml-1 underline decoration-dotted text-blue-600 dark:text-blue-400 ${u}`,children:o.value}):e.jsx("span",{className:`ml-1 text-slate-900 dark:text-slate-100 ${u}`,children:o.value})]},m))]}),se=({data:s})=>{var t;const a=[{icon:e.jsx(g,{className:"text-slate-500"}),label:"Invoice",value:s.name||"N/A",isLink:!0},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Order",value:((t=s.items[0])==null?void 0:t.purchase_order)||"N/A",isLink:!0},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Supplier",value:s.supplier_name||"N/A"},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Posting Date",value:s.posting_date||"N/A"},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Warehouse",value:s.set_warehouse||"N/A"},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Status",value:e.jsx(X,{color:"blue",children:s.status||"Unknown"})}];return e.jsx(e.Fragment,{children:e.jsx(ee,{title:"Purchase Details",items:a})})},ae=s=>{var a;return{warehouse:(a=s==null?void 0:s.set_warehouse)!=null?a:void 0,date:s!=null&&s.posting_date?b(s.posting_date):b(),file:void 0,fromRange:"",toRange:"",totalRangeValue:""}},Pe=()=>{const{invoice_number:s}=E(),a=Z(),t=O(),{data:r,isLoading:d,isValidating:h}=U(s!=null?s:""),{call:u,loading:c}=W(),o=j.useMemo(()=>ae(r),[r]),{control:m,watch:D,handleSubmit:L,setValue:N,reset:R}=z({values:o,mode:"onChange",resetOptions:{keepDirtyValues:!0}}),[p,x]=D(["fromRange","toRange"]),{total:v,error:y}=j.useMemo(()=>G(p,x),[p,x]),k=q(Y);j.useEffect(()=>{y&&p&&x&&a.error({message:y})},[y,p,x,a]),j.useEffect(()=>{p&&x&&N("totalRangeValue",v.toString(),{shouldValidate:!0,shouldDirty:!0})},[p,x,N,v]),H("serial_assign_process",f=>{a.info({message:"Processing...",key:"processing",description:e.jsx("li",{children:f.message}),duration:0})});const T=()=>{R(),t(J())},P=f=>A(void 0,null,function*(){const V=k.reduce((l,i)=>{const n=i.item_name;return l[n]?(l[n].qty+=i.qty,l[n].amount+=i.amount,l[n].serial_no=[...l[n].serial_no,...i.serial_no]):l[n]=w({},i),l},{}),$={posting_date:b(f.date).format("YYYY-MM-DD"),posting_time:b(f.date).format("HH:mm:ss"),purchase_invoice_name:r==null?void 0:r.name,supplier:r==null?void 0:r.supplier,total:k.reduce((l,i)=>{var n;return l+((n=i.amount)!=null?n:0)},0),total_qty:k.reduce((l,i)=>{var n;return l+((n=i.qty)!=null?n:0)},0),warehouse:f.warehouse,items:Object.values(V)};yield u($).then(l=>{var i;a.success({message:(i=JSON.parse(l.message))==null?void 0:i.message}),T()}).catch(l=>{a.error({message:"ERROR",description:l.exception})}).finally(()=>{a.close("processing")})});return d||h?e.jsx(B,{pageLoader:!0}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center mt-8 intro-y sm:flex-row",children:[e.jsx("h2",{className:"mr-auto text-lg font-medium",children:"Transaction Details"}),e.jsx("div",{className:"flex w-full mt-4 sm:w-auto sm:mt-0",children:e.jsx(I,{color:"primary",variant:"solid",onClick:L(P),loading:c,children:"Submit"})})]}),e.jsxs("div",{className:"grid grid-cols-11 gap-5 mt-5",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-4 2xl:col-span-3 intro-y",children:[r&&e.jsx(se,{data:r}),e.jsxs("div",{className:"p-5 rounded-md box mt-5",children:[e.jsx("div",{className:"flex items-center pb-5 mb-5 border-b border-slate-200/60 dark:border-darkmode-400",children:e.jsx("div",{className:"text-base font-medium truncate",children:"Serial Assign"})}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsx(K,{control:m,items:(r==null?void 0:r.items)||[]}),e.jsxs("p",{className:"text-lg text-primary",children:["Total : ",v]})]})]})]}),e.jsx("div",{className:"col-span-12 lg:col-span-7 2xl:col-span-8 intro-x",children:e.jsx(Q,{data:r,control:m,setValue:N})})]})]})};export{Pe as default};
