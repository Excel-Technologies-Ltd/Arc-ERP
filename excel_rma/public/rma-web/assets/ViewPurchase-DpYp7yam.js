var F=Object.defineProperty;var S=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var w=(s,a,t)=>a in s?F(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,A=(s,a)=>{for(var t in a||(a={}))C.call(a,t)&&w(s,t,a[t]);if(S)for(var t of S(a))E.call(a,t)&&w(s,t,a[t]);return s};var _=(s,a,t)=>new Promise((r,c)=>{var h=o=>{try{d(t.next(o))}catch(m){c(m)}},u=o=>{try{d(t.throw(o))}catch(m){c(m)}},d=o=>o.done?r(o.value):Promise.resolve(o.value).then(h,u);d((t=t.apply(s,a)).next())});import{j as e,c as O,a as q,r as f,u as M,d as Y,L as H,e as B}from"./index-D1mrJr2I.js";import{a as J,p as U}from"./purchase-BeNndN-B.js";import{u as W}from"./index.esm-BSHO5Wel.js";import{d as j,a as z}from"./helper-CXF6WUes.js";import{a as G}from"./index-DFN__vdy.js";import"./app-strings-JO10r9wa.js";import{L as g,S as I,P as K}from"./SerialAssignForm-BXM16BzJ.js";import{T as Q}from"./index-DixGxXzh.js";import"./AntDatePicker-CtToRsMI.js";import"./index-B4rHkQzE.js";import{u as X}from"./useNotify-CAJG48TN.js";import"./pagination.utils-Dq4giu9F.js";import"./doctype-strings-C-G4L_vj.js";import"./roundedArrow-CIi-9AS-.js";import"./useMergedState-BhN0zUFX.js";import"./index-BeiADSXX.js";import"./bundle-mjs-Bbh6cNEC.js";import"./index-CpROZWdP.js";import"./index-L1RRLDfd.js";import"./AntSelect-Cf2MoRed.js";import"./LeftOutlined-BW9Aek7M.js";import"./AntInput-DB7GDmQZ.js";import"./iconBase-LS0x1pUI.js";import"./AntCustomTable-BsjEcgQT.js";import"./dropdown-BU6ACuBx.js";import"./RenderController-xkgsdMvX.js";import"./AntUpload-DDaAD8DK.js";import"./dropdownApi-4KzlHgCe.js";const Z=({title:s="Details",items:a,className:t="",titleClassName:r="",itemClassName:c="",iconClassName:h="",valueClassName:u="",border:d=!0})=>e.jsxs("div",{className:`p-5 rounded-md bg-white shadow-sm border border-gray-200 dark:bg-darkmode-800 dark:border-darkmode-600 ${t}`,children:[s&&e.jsx("div",{className:`flex items-center pb-5 mb-5 ${d?"border-b border-slate-200/60 dark:border-darkmode-400":""}`,children:e.jsx("div",{className:`text-base font-medium truncate ${r}`,children:s})}),a.map((o,m)=>e.jsxs("div",{className:`flex items-center ${m>0?"mt-3":""} ${c}`,children:[o.icon&&e.jsx("span",{className:`w-4 h-4 mr-2 flex items-center justify-center ${h}`,children:o.icon}),e.jsxs("span",{className:"mr-1 text-slate-700 dark:text-slate-300",children:[o.label,":"]}),o.isLink?e.jsx("span",{className:`ml-1 underline decoration-dotted text-blue-600 dark:text-blue-400 ${u}`,children:o.value}):e.jsx("span",{className:`ml-1 text-slate-900 dark:text-slate-100 ${u}`,children:o.value})]},m))]}),ee=({data:s})=>{var t;const a=[{icon:e.jsx(g,{className:"text-slate-500"}),label:"Invoice",value:s.name||"N/A",isLink:!0},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Order",value:((t=s.items[0])==null?void 0:t.purchase_order)||"N/A",isLink:!0},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Supplier",value:s.supplier_name||"N/A"},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Posting Date",value:s.posting_date||"N/A"},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Warehouse",value:s.set_warehouse||"N/A"},{icon:e.jsx(g,{className:"text-slate-500"}),label:"Status",value:e.jsx(Q,{color:"blue",children:s.status||"Unknown"})}];return e.jsx(e.Fragment,{children:e.jsx(Z,{title:"Purchase Details",items:a})})},se=s=>{var a;return{warehouse:(a=s==null?void 0:s.set_warehouse)!=null?a:void 0,date:s!=null&&s.posting_date?j(s.posting_date):j(),file:void 0,fromRange:"",toRange:"",totalRangeValue:""}},Te=()=>{const{invoice_number:s}=O(),a=X(),t=q(),{data:r,isLoading:c,isValidating:h}=J(s!=null?s:""),{call:u,loading:d}=U(),o=f.useMemo(()=>se(r),[r]),{control:m,watch:D,handleSubmit:L,setValue:b,reset:R}=W({values:o,mode:"onChange",resetOptions:{keepDirtyValues:!0}}),[p,x]=D(["fromRange","toRange"]),{total:N,error:v}=f.useMemo(()=>z(p,x),[p,x]),y=M(Y);f.useEffect(()=>{v&&p&&x&&a.error({message:v})},[v,p,x,a]),f.useEffect(()=>{p&&x&&b("totalRangeValue",N.toString(),{shouldValidate:!0,shouldDirty:!0})},[p,x,b,N]);const T=()=>{R(),t(B())},P=k=>_(void 0,null,function*(){const V=y.reduce((l,i)=>{const n=i.item_name;return l[n]?(l[n].qty+=i.qty,l[n].amount+=i.amount,l[n].serial_no=[...l[n].serial_no,...i.serial_no]):l[n]=A({},i),l},{}),$={posting_date:j(k.date).format("YYYY-MM-DD"),posting_time:j(k.date).format("HH:mm:ss"),purchase_invoice_name:r==null?void 0:r.name,supplier:r==null?void 0:r.supplier,total:y.reduce((l,i)=>{var n;return l+((n=i.amount)!=null?n:0)},0),total_qty:y.reduce((l,i)=>{var n;return l+((n=i.qty)!=null?n:0)},0),warehouse:k.warehouse,items:Object.values(V)};yield u($).then(l=>{var i;a.success({message:(i=JSON.parse(l.message))==null?void 0:i.message}),T()}).catch(l=>{a.error({message:"ERROR",description:l.exception})})});return c||h?e.jsx(H,{pageLoader:!0}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center mt-8 intro-y sm:flex-row",children:[e.jsx("h2",{className:"mr-auto text-lg font-medium",children:"Transaction Details"}),e.jsx("div",{className:"flex w-full mt-4 sm:w-auto sm:mt-0",children:e.jsx(G,{color:"primary",variant:"solid",onClick:L(P),loading:d,children:"Submit"})})]}),e.jsxs("div",{className:"grid grid-cols-11 gap-5 mt-5",children:[e.jsxs("div",{className:"col-span-12 lg:col-span-4 2xl:col-span-3 intro-y",children:[r&&e.jsx(ee,{data:r}),e.jsxs("div",{className:"p-5 rounded-md box mt-5",children:[e.jsx("div",{className:"flex items-center pb-5 mb-5 border-b border-slate-200/60 dark:border-darkmode-400",children:e.jsx("div",{className:"text-base font-medium truncate",children:"Serial Assign"})}),e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsx(I,{control:m,items:(r==null?void 0:r.items)||[]}),e.jsxs("p",{className:"text-lg text-primary",children:["Total : ",N]})]})]})]}),e.jsx("div",{className:"col-span-12 lg:col-span-7 2xl:col-span-8 intro-x",children:e.jsx(K,{data:r,control:m,setValue:b})})]})]})};export{Te as default};
