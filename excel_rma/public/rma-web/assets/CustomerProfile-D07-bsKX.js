var B=Object.defineProperty;var P=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var v=(e,t,r)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,L=(e,t)=>{for(var r in t||(t={}))A.call(t,r)&&v(e,r,t[r]);if(P)for(var r of P(t))I.call(t,r)&&v(e,r,t[r]);return e};import{r as m,D as $,aJ as E,b0 as M,b1 as V,b2 as T,b3 as W,d as R,b4 as z,b5 as q,b6 as G,b7 as j,b8 as H,b9 as J,ba as U,bb as Y,bc as S,bd as K,be as Q,F as O,u as X,bf as Z,j as s,bg as k,an as D,ao as ee,ap as te,aq as se}from"./index-BIiC1RfR.js";import{w as ae,A as re}from"./AntSelect-Ci9nRWmV.js";import{C as ne}from"./CustomTable-DWhpwjDH.js";import{p as le}from"./pagination.utils-Dq4giu9F.js";import{B as N}from"./index-DzfHmuOq.js";import{f as u}from"./helper-COlveQpz.js";import{A as ie}from"./AntInput-DOXU06x0.js";import{b as oe}from"./commonApi-BDPvyriq.js";import"./bundle-mjs-Bbh6cNEC.js";import"./dayjs.min-X1kAEbDH.js";var ce=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(r[a[n]]=e[a[n]]);return r};const de=e=>{const{prefixCls:t,className:r,closeIcon:a,closable:n,type:l,title:c,children:x,footer:b}=e,g=ce(e,["prefixCls","className","closeIcon","closable","type","title","children","footer"]),{getPrefixCls:p}=m.useContext($),h=p(),d=t||p("modal"),f=E(h),[C,_,w]=M(d,f),y=`${d}-confirm`;let i={};return l?i={closable:n!=null?n:!1,title:"",footer:"",children:m.createElement(V,Object.assign({},e,{prefixCls:d,confirmPrefixCls:y,rootPrefixCls:h,content:x}))}:i={closable:n!=null?n:!0,title:c,footer:b!==null&&m.createElement(T,Object.assign({},e)),children:x},C(m.createElement(W,Object.assign({prefixCls:d,className:R(_,`${d}-pure-panel`,l&&y,l&&`${y}-${l}`,r,w,f)},g,{closeIcon:z(d,a),closable:n},i)))},me=ae(de);function F(e){return j(Q(e))}const o=q;o.useModal=G;o.info=function(t){return j(H(t))};o.success=function(t){return j(J(t))};o.error=function(t){return j(U(t))};o.warning=F;o.warn=F;o.confirm=function(t){return j(Y(t))};o.destroyAll=function(){for(;S.length;){const t=S.pop();t&&t()}};o.config=K;o._InternalPanelDoNotUseOrYouWillBeFired=me;const fe=e=>{const t=O(),{isOpen:r}=X(Z),a=()=>{t(k({type:"",isOpen:!1}))};return s.jsx(o,L({footer:!1,open:r,centered:!0,onCancel:a},e))},ue=({customer_name:e,territory:t})=>{const[r]=D(),{limit_start:a,pageSize:n}=le(r),l=[...e?[["name","like",`%${e}%`]]:[],...t?[["territory","like",`%${t}%`]]:[]],{data:c,isLoading:x,isValidating:b,error:g}=ee("Customer",{fields:["name","customer_name","territory","excel_remaining_balance","custom_other_brands_limit"],filters:l,orderBy:{field:"name",order:"asc"},limit:n,limit_start:a}),{data:p,isLoading:h,isValidating:d,error:f}=te("Customer",l);return{data:c,isLoading:x||h,isValidating:b||d,error:g||f,total:p}},xe=e=>se("Customer",e,`name:${e}`,{isPaused:()=>!e}),pe=e=>{const t=O();return m.useMemo(()=>[{key:"Sl",title:"SL",render:(a,n,l)=>s.jsx("span",{children:l+1})},{key:"customer_name",title:"Customer Name"},{key:"territory",title:"Territory Name"},{key:"excel_remaining_balance",title:"Credit Limit",render:a=>u(a)},{key:"current_outstanding",title:"Current Outstanding",render:a=>u(a)},{key:"custom_other_brands_limit",title:"Remaining Credit",render:a=>u(a)},{key:"brand_wise_limit",title:"Brand Wise Limit",render:(a,n)=>s.jsx(N,{variant:"outline-primary",size:"sm",onClick:()=>{e(n.customer_name),t(k({type:"brand-wise-limit",isOpen:!0}))},children:"Details"})}],[e,t])},he=({customerDocument:e})=>{var t,r;return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"bg-white dark:bg-darkmode rounded-lg",children:[s.jsxs("div",{className:"flex justify-between items-center my-4",children:[s.jsxs("div",{className:"text-lg font-semibold",children:["Total Remaining Balance:"," ",s.jsx("span",{className:"text-lg font-bold",children:u((e==null?void 0:e.excel_remaining_balance)||0)})]}),s.jsxs("div",{className:"text-lg font-semibold",children:["Brand Wise Allocated Limit:"," ",s.jsx("span",{className:"text-lg font-bold",children:u(((t=e==null?void 0:e.custom_brand_wise_allocations)==null?void 0:t.reduce((a,n)=>a+n.limit,0))||0)})]})]}),s.jsx("div",{className:"overflow-x-auto rounded-lg border",children:s.jsxs("table",{className:"min-w-full table-auto",children:[s.jsx("thead",{className:"bg-primary text-white",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left",children:"Brand Name"}),s.jsx("th",{className:"px-6 py-3 text-left",children:"Limit Amount"})]})}),s.jsxs("tbody",{className:"bg-gray-50",children:[(r=e==null?void 0:e.custom_brand_wise_allocations)==null?void 0:r.map(a=>s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 text-left",children:a.brand}),s.jsx("td",{className:"px-6 py-4 text-left",children:u(a.limit)})]},a.name)),s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 text-left",children:"Others"}),s.jsx("td",{className:"px-6 py-4 text-left",children:u((e==null?void 0:e.custom_other_brands_limit)||0)})]})]})]})})]})})},Se=()=>{const[e,t]=m.useState(""),[r,a]=m.useState(null),[n,l]=m.useState(null),[c,x]=m.useState(null),{data:b,isLoading:g,total:p}=ue({customer_name:r!=null?r:"",territory:c!=null?c:""}),{data:h,isLoading:d,mutate:f}=xe(e),{data:C,isLoading:_}=oe(n);m.useEffect(()=>{e&&f()},[e,f]);const w=pe(t),y=()=>{a(null),l(null)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-wrap items-center col-span-12 mt-5 intro-y xl:flex-nowrap gap-3",children:[s.jsx("h2",{className:"text-lg font-medium intro-y whitespace-nowrap",children:"Customer Profile"}),s.jsxs("div",{className:"flex w-full gap-2 flex-wrap lg:flex-nowrap",children:[s.jsx(ie,{placeholder:"Customer Name",type:"text",onChange:i=>a(i.target.value),value:r!=null?r:""}),s.jsx(re,{placeholder:"Select Branch",value:c!=null?c:void 0,onChange:i=>{x(i),l(null)},onSearch:i=>l(i),loading:_,options:C==null?void 0:C.map(i=>({value:i.name,label:i.territory_name})),notFoundText:"No Branch Found"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{variant:"outline-primary",children:"Search"}),s.jsx(N,{onClick:y,variant:"outline-primary",children:"Clear"})]})]})]}),s.jsx("div",{className:"mt-5",children:s.jsx(ne,{tableHeader:w||[],data:b||[],loading:g,totalItems:p||0})}),s.jsx(fe,{title:s.jsxs("div",{className:"text-xl font-semibold text-center border-b border-gray-200 pb-2",children:["Brand Wise Limit - ",e]}),loading:d,width:800,children:s.jsx(he,{customerDocument:h})})]})};export{Se as default};
